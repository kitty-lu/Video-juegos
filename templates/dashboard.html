{% include 'layout/header_dashboard.html' %}
    {% include 'layout/nav.html' %}

<body class="bg-body-primary">
    <!-- Fondos primero -->
    <div class="light-mode-bg" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1000; background: url('https://i.pinimg.com/originals/7d/68/ab/7d68abd537942d95ac5b2cbb53ed3cf0.gif') center/cover no-repeat; opacity: 1; transition: opacity 0.5s ease;"></div>
    <div class="dark-mode-bg" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1000; background: url('https://i.pinimg.com/originals/76/cc/71/76cc71fb45866a23a21ba5124743da4e.gif') center/cover no-repeat; opacity: 0; transition: opacity 0.5s ease;"></div>


    <!-- Contenido principal -->
    <div class="container-fluid" style="position: relative; z-index: 1;">
        <!-- Efecto de partículas -->
        <div id="dashboard-particles"></div>
        <div class="dashboard-container">
            <!-- Stats Cards -->
            <div class="row mb-4 stats-row">
                <div class="col-md-3">
                    <div class="stats-card neon-stats" data-aos="fade-up" data-aos-delay="100">
                        <div class="stats-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stats-content">
                            <div class="metric" id="totalSales">0.00M</div>
                            <span class="variation" id="totalSalesVar"></span>
                        </div>
                        <div class="stats-wave"></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card neon-stats" data-aos="fade-up" data-aos-delay="200">
                        <div class="stats-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <div class="stats-content">
                            <div class="metric" id="leadingPlatform">N/A</div>
                            <span class="variation">Plataforma Líder</span>
                        </div>
                        <div class="stats-wave"></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card neon-stats" data-aos="fade-up" data-aos-delay="300">
                        <div class="stats-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stats-content">
                            <div class="metric" id="popularGenre">N/A</div>
                            <span class="variation">Género Popular</span>
                        </div>
                        <div class="stats-wave"></div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card neon-stats" data-aos="fade-up" data-aos-delay="400">
                        <div class="stats-icon">
                            <i class="fas fa-calendar"></i>
                        </div>
                        <div class="stats-content">
                            <div class="metric" id="topYear">N/A</div>
                            <span class="variation" id="topYearVar"></span>
                        </div>
                        <div class="stats-wave"></div>
                    </div>
                </div>
            </div>

            <!-- Filtros -->
            <details class="mb-4 filter-section" data-aos="fade-up">
                <summary class="filter-header">
                    <i class="fas fa-filter me-2"></i>
                    <span class="glitch" data-text="Filtros de visualización">Filtros de visualización</span>
                    <i class="fas fa-chevron-down filter-arrow"></i>
                </summary>
                <div class="filter-content" data-aos="fade-up">
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <label for="filterPlataforma" class="form-label">Plataformas:</label>
                            <select id="filterPlataforma" class="form-select neon-select" multiple>
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="filterGenero" class="form-label">Géneros:</label>
                            <select id="filterGenero" class="form-select neon-select" multiple>
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="filterAnio" class="form-label">Años:</label>
                            <select id="filterAnio" class="form-select neon-select" multiple>
                                <option value="">Todos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="filterEditor" class="form-label">Editores:</label>
                            <select id="filterEditor" class="form-select neon-select" multiple>
                                <option value="">Todos</option>
                            </select>
                        </div>
                    </div>
                </div>
            </details>

            <!-- Tabla de datos -->
            <details class="mb-4 data-table-section" data-aos="fade-up">
                <summary class="data-table-header">
                    <i class="fas fa-table me-2"></i>
                    <span class="glitch" data-text="Ver tabla de datos">Ver tabla de datos</span>
                    <i class="fas fa-chevron-down table-arrow"></i>
                </summary>
                <div class="mt-3 table-responsive" data-aos="fade-up">
                    <table id="tablaDatos" class="table table-striped neon-table" style="width:100%">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Plataforma</th>
                                <th>Año</th>
                                <th>Género</th>
                                <th>Editor</th>
                                <th>Ventas NA</th>
                                <th>Ventas EU</th>
                                <th>Ventas JP</th>
                                <th>Ventas Otros</th>
                                <th>Ventas Globales</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </details>

            <!-- Gráficos -->
            <div class="card neon-card" data-aos="fade-up">
                <ul class="nav nav-tabs neon-tabs" id="chartTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="region-publisher-tab" data-bs-toggle="tab" data-bs-target="#region-publisher" type="button" role="tab">
                            <i class="fas fa-globe-americas me-1"></i> Región y Editorial
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="platform-genre-tab" data-bs-toggle="tab" data-bs-target="#platform-genre" type="button" role="tab">
                            <i class="fas fa-gamepad me-1"></i> Plataforma y Género
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="year-comparison-tab" data-bs-toggle="tab" data-bs-target="#year-comparison" type="button" role="tab">
                            <i class="fas fa-chart-line me-1"></i> Año y Comparación
                        </button>
                    </li>
                </ul>
                <div class="tab-content" id="chartTabContent">
                    <!-- Región y Editorial -->
                    <div class="tab-pane fade show active" id="region-publisher" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6" data-aos="fade-right">
                                <div class="chart-container">
                                    <canvas id="regionSalesBar"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6" data-aos="fade-left">
                                <div class="chart-container">
                                    <canvas id="overviewPie"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Plataforma y Género -->
                    <div class="tab-pane fade" id="platform-genre" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6" data-aos="fade-right">
                                <div class="chart-container">
                                    <canvas id="platformBar"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6" data-aos="fade-left">
                                <div class="chart-container">
                                    <canvas id="genreRadar"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6" data-aos="fade-right">
                                <div class="chart-container">
                                    <canvas id="platformDoughnut"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6" data-aos="fade-left">
                                <div class="chart-container">
                                    <canvas id="genrePie"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Año y Comparación -->
                    <div class="tab-pane fade" id="year-comparison" role="tabpanel">
                        <div class="row mb-3" data-aos="fade-up">
                            <div class="col">
                                <div class="btn-group period-buttons">
                                    <button class="btn btn-outline-primary period-btn active" data-period="all">
                                        <i class="fas fa-infinity me-1"></i> Todos
                                    </button>
                                    <button class="btn btn-outline-primary period-btn" data-period="last5">
                                        <i class="fas fa-calendar-week me-1"></i> Últimos 5 Años
                                    </button>
                                    <button class="btn btn-outline-primary period-btn" data-period="last">
                                        <i class="fas fa-calendar-day me-1"></i> Último Año
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6" data-aos="fade-right">
                                <div class="chart-container">
                                    <canvas id="yearlyTrend"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6" data-aos="fade-left">
                                <div class="chart-container">
                                    <canvas id="regionComparison"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6" data-aos="fade-right">
                                <div class="chart-container">
                                    <canvas id="genrePolarArea"></canvas>
                                </div>
                            </div>
                            <div class="col-md-6" data-aos="fade-left">
                                <div class="chart-container">
                                    <canvas id="publisherHorizontalBar"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
       <!-- Scripts -->
        {% include 'layout/scripts.html' %}
        <!-- AOS Animation Library -->
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        
        <!-- Particles.js -->
        <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
        <script src="{{ url_for('static', filename='js/dashboard.js') }}?v=3.0.0"></script>
        
        <script>
// Theme toggle function
function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    updateTheme();
    updateThemeButton(); // Nueva función para actualizar el texto del botón
}

// Theme update function
function updateTheme() {
    const isDarkMode = document.body.classList.contains('dark-mode');
    const lightBg = document.querySelector('.light-mode-bg');
    const darkBg = document.querySelector('.dark-mode-bg');
    
    if (isDarkMode) {
        darkBg.style.opacity = '1';
        lightBg.style.opacity = '0';
    } else {
        lightBg.style.opacity = '1';
        darkBg.style.opacity = '0';
    }
}

// Nueva función para actualizar el botón
function updateThemeButton() {
    const isDarkMode = document.body.classList.contains('dark-mode');
    const themeButton = document.getElementById('toggleTheme');
    const icon = themeButton.querySelector('i');
    
    if (isDarkMode) {
        themeButton.className = 'btn btn-outline-light';
        icon.className = 'fas fa-sun';
        themeButton.innerHTML = '<i class="fas fa-sun"></i> Modo Claro';
    } else {
        themeButton.className = 'btn btn-outline-dark';
        icon.className = 'fas fa-moon';
        themeButton.innerHTML = '<i class="fas fa-moon"></i> Modo Oscuro';
    }
}

// Al cargar la página, verificar el tema inicial
document.addEventListener('DOMContentLoaded', function() {
    // Verificar si hay una preferencia guardada
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
    }
        AOS.init();
    initParticles();
    loadDataAndCharts();
    updateTheme();
    updateThemeButton();

                // Observe theme changes
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.attributeName === 'class') {
                            updateTheme();
                        }
                    });
                });
                
                observer.observe(document.body, {
                    attributes: true,
                    attributeFilter: ['class']
                });
                
                // Stats cards hover effect
                const statsCards = document.querySelectorAll('.stats-card');
                statsCards.forEach(card => {
                    card.addEventListener('mousemove', (e) => {
                        const x = e.pageX - card.getBoundingClientRect().left;
                        const y = e.pageY - card.getBoundingClientRect().top;
                        
                        const centerX = card.offsetWidth / 2;
                        const centerY = card.offsetHeight / 2;
                        
                        const angleX = (centerY - y) / 10;
                        const angleY = (x - centerX) / 10;
                        
                        card.style.transform = `perspective(1000px) rotateX(${angleX}deg) rotateY(${angleY}deg)`;
                    });
                    
                    card.addEventListener('mouseleave', () => {
                        card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
                    });
                });
                
                // Typewriter effect for placeholders
                const inputs = document.querySelectorAll('.neon-select');
                inputs.forEach(input => {
                    const placeholder = input.getAttribute('placeholder') || '';
                    input.setAttribute('placeholder', '');
                    let i = 0;
                    
                    const typeWriter = setInterval(() => {
                        if (i < placeholder.length) {
                            input.setAttribute('placeholder', input.getAttribute('placeholder') + placeholder.charAt(i));
                            i++;
                        } else {
                            clearInterval(typeWriter);
                        }
                    }, 50);
                });
            });
            // Modificar la función toggleTheme para guardar la preferencia
function toggleTheme() {
    document.body.classList.toggle('dark-mode');
    
    // Guardar la preferencia
    const isDarkMode = document.body.classList.contains('dark-mode');
    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    
    updateTheme();
    updateThemeButton();
}
        </script>
    </div>
</body>
{% include 'layout/footer_dashboard.html' %}
</html>